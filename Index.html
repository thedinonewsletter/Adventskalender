<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Adventskalender-Quiz</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 1rem; }
    .calendar { display: grid; grid-template-columns: repeat(6, 1fr); gap: 0.5rem; margin-top: 1rem; }
    .door {
      padding: 1rem;
      border: 1px solid #ccc;
      text-align: center;
      cursor: pointer;
      border-radius: 4px;
      opacity: 0.6;
    }
    .door.openable { background: #f5f5f5; opacity: 1; }
    .door.locked { cursor: not-allowed; }
    #question-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); }
    #question-content { background: white; max-width: 400px; margin: 10% auto; padding: 1rem; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>Adventskalender-Quiz</h1>

  <label>
    Dein Name:
    <input id="nameInput" type="text" />
  </label>
  <button id="saveNameBtn">Weiter</button>

  <div id="calendar" class="calendar" style="display:none;"></div>

  <div id="question-modal">
    <div id="question-content">
      <h2 id="question-title"></h2>
      <p id="question-text"></p>
      <textarea id="answerInput" rows="4" style="width:100%;"></textarea>
      <br />
      <button id="sendAnswerBtn">Antwort senden</button>
      <button id="closeModalBtn">Schließen</button>
      <p id="feedback" style="color:green;"></p>
    </div>
  </div>

  <script>
    // Beispiel-Fragen – später kannst du die vom Server laden
    const QUESTIONS = {
      1: "Frage für den 1. Dezember",
      2: "Frage für den 2. Dezember",
      // ...
      24: "Frage für den 24. Dezember"
    };

    const nameInput = document.getElementById('nameInput');
    const saveNameBtn = document.getElementById('saveNameBtn');
    const calendar = document.getElementById('calendar');

    const modal = document.getElementById('question-modal');
    const questionTitle = document.getElementById('question-title');
    const questionText = document.getElementById('question-text');
    const answerInput = document.getElementById('answerInput');
    const sendAnswerBtn = document.getElementById('sendAnswerBtn');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const feedback = document.getElementById('feedback');

    let currentDay = null;

    function getTodayDay() {
      const now = new Date();
      const month = now.getMonth(); // 0 = Jan, 11 = Dez
      if (month !== 11) return null; // nur im Dezember
      return now.getDate(); // 1..31
    }

    function initName() {
      const storedName = localStorage.getItem('ak_name');
      if (storedName) {
        nameInput.value = storedName;
        showCalendar();
      }
    }

    function showCalendar() {
      if (!nameInput.value.trim()) {
        alert("Bitte gib zuerst deinen Namen ein.");
        return;
      }

      localStorage.setItem('ak_name', nameInput.value.trim());
      calendar.innerHTML = "";
      calendar.style.display = "grid";

      const today = getTodayDay();

      for (let day = 1; day <= 24; day++) {
        const div = document.createElement('div');
        div.classList.add('door');
        div.textContent = day;

        if (today !== null && day <= today) {
          div.classList.add('openable');
          div.addEventListener('click', () => openDoor(day));
        } else {
          div.classList.add('locked');
        }

        calendar.appendChild(div);
      }
    }

    function openDoor(day) {
      const today = getTodayDay();
      if (today === null || day > today) {
        alert("Dieses Türchen ist noch nicht freigeschaltet.");
        return;
      }
      currentDay = day;
      questionTitle.textContent = `Türchen ${day}`;
      questionText.textContent = QUESTIONS[day] || "Keine Frage hinterlegt.";
      answerInput.value = "";
      feedback.textContent = "";
      modal.style.display = "block";
    }

    async function sendAnswer() {
      const name = localStorage.getItem('ak_name');
      const answer = answerInput.value.trim();
      if (!answer) {
        alert("Bitte gib eine Antwort ein.");
        return;
      }

      try {
        // Hier dein Backend-Endpoint eintragen:
        const res = await fetch('/api/answer', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name,
            day: currentDay,
            answer
          })
        });

        if (!res.ok) throw new Error("Serverfehler");
        feedback.textContent = "Antwort gespeichert – danke!";
      } catch (e) {
        feedback.style.color = "red";
        feedback.textContent = "Fehler beim Speichern, bitte später erneut versuchen.";
      }
    }

    saveNameBtn.addEventListener('click', showCalendar);
    sendAnswerBtn.addEventListener('click', sendAnswer);
    closeModalBtn.addEventListener('click', () => modal.style.display = "none");

    initName();
  </script>
</body>
</html>
